<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForgeMyCV - Modern & Responsive Resume Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- START OF CSS REDESIGN --- */

        /* --- 1. Root Variables & General Styles --- */
        :root {
            --primary-color: #000000; /* A deep, modern black */
            --primary-dark: #5B21B6; /* Kept for reference, but blue is the new accent */
            --secondary-color: #3B82F6; /* A modern, professional blue */
            --secondary-dark: #2563EB;
            --danger-color: #EF4444;
            --dark-text: #111827;
            --light-text: #ffffff;
            --body-bg: #F9FAFB;
            --panel-bg: #ffffff;
            --border-color: #E5E7EB;
            --placeholder-color: #9CA3AF;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --transition-speed: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
            --font-family: 'Inter', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--body-bg);
            color: var(--dark-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- 2. Main Layout & Structure --- */
        .forgemycv-container {
            display: flex;
            min-height: 100vh;
        }

        #cmcv-form-section {
            width: 40%;
            padding: 40px;
            background: var(--panel-bg);
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
            border-right: 1px solid var(--border-color);
            transition: all var(--transition-speed);
        }

        #cmcv-preview-section {
            width: 60%;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        
        /* --- 3. On-Screen Credit Styling --- */
        .on-screen-credit {
            margin-top: 25px;
            font-size: 13px;
            color: var(--placeholder-color);
            font-weight: 500;
        }
        .on-screen-credit a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .on-screen-credit a:hover {
            text-decoration: underline;
        }

        /* --- 4. Form Section Styling --- */
        #cmcv-form-section h1 {
            font-size: 36px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 35px;
            letter-spacing: -1.5px;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        #cmcv-form-section h1 .logo-icon {
            width: 32px;
            height: 32px;
            color: var(--secondary-color);
        }
        #cmcv-form-section h1 span {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .cmcv-form-group { 
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.95); } }

        .cmcv-form-group h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark-text);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .cmcv-form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        .cmcv-form-group input,
        .cmcv-form-group textarea,
        .cmcv-form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            background-color: var(--body-bg);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .cmcv-form-group input::placeholder,
        .cmcv-form-group textarea::placeholder { color: var(--placeholder-color); }

        .cmcv-form-group input:focus,
        .cmcv-form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .cmcv-form-group textarea { resize: vertical; min-height: 120px; }

        .cmcv-dynamic-entry {
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            background-color: var(--panel-bg);
            display: flex;
            flex-direction: column;
            gap: 15px;
            animation: fadeIn 0.4s ease-out;
            position: relative;
        }

        /* --- 5. Buttons & Controls --- */
        .cmcv-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all var(--transition-speed);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            color: var(--light-text);
        }
        .cmcv-btn svg { width: 16px; height: 16px; }

        .cmcv-btn-add { background-color: var(--primary-color); }
        .cmcv-btn-add:hover { background-color: #374151; transform: translateY(-2px); box-shadow: var(--shadow-sm); }
        
        .cmcv-btn-remove { background-color: var(--danger-color); margin-top: 10px; width: 100%; }
        .cmcv-btn-remove:hover { background-color: #B91C1C; }

        .cmcv-controls {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            width: 100%;
            max-width: 816px;
            border: 1px solid var(--border-color);
        }
        
        .cmcv-control-group { display: flex; flex-direction: column; flex-grow: 1; min-width: 150px; }
        
        .cmcv-control-group label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--dark-text);
        }
        
        .cmcv-control-group select, .cmcv-control-group .cmcv-btn {
            height: 48px;
            width: 100%;
            background-color: var(--body-bg);
            border: 1px solid var(--border-color);
            color: var(--dark-text);
            font-weight: 500;
            border-radius: 8px;
            padding: 0 15px;
        }
        
        .cmcv-control-group select {
             -webkit-appearance: none;
             -moz-appearance: none;
             appearance: none;
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%239CA3AF' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
             background-repeat: no-repeat;
             background-position: right 15px center;
        }

        .cmcv-btn-download { background-color: var(--secondary-color); color: var(--light-text); }
        .cmcv-btn-download:hover { background-color: var(--secondary-dark); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
        
        /* --- 6. Preview Area Styling --- */
        #cmcv-resume-preview {
            width: 100%;
            max-width: 816px; /* US Letter paper width @ 96 DPI */
            min-height: 1056px; /* US Letter paper height */
            background: var(--panel-bg);
            box-shadow: var(--shadow);
            transition: all var(--transition-speed);
            overflow: hidden;
            border-radius: 6px;
        }
        
        #cmcv-resume-preview.two-page { min-height: 2112px; }

        /* --- 7. Resume Content Styles --- */
        .resume-content { padding: 50px; color: #374151; font-family: 'Inter', sans-serif; }
        .resume-content a { word-break: break-word; color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .resume-content a:hover { text-decoration: underline; }

        .resume-header { text-align: center; border-bottom: 2px solid; padding-bottom: 20px; margin-bottom: 25px; }
        .resume-header h2 { font-size: 42px; margin-bottom: 8px; font-weight: 700; letter-spacing: -1px; }
        .resume-contact-info { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px 20px; margin-top: 15px; font-size: 13px; color: #4B5563; }

        .resume-section { margin-bottom: 25px; page-break-inside: avoid; }
        .resume-section h3 { font-size: 20px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; border-bottom: 2px solid; padding-bottom: 8px; margin-bottom: 20px; }
        .resume-section h4 { font-size: 16px; font-weight: 600; margin-top: 20px; margin-bottom: 10px; color: #1F2937; }
        .resume-section h4:first-of-type { margin-top: 0; }

        .resume-entry { margin-bottom: 20px; page-break-inside: avoid; }
        .resume-entry-header { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 5px; font-weight: 600; align-items: baseline; }
        .resume-entry .title { font-size: 17px; }
        .resume-entry .meta { color: #4B5563; font-size: 14px; text-align: right; font-weight: 500; }
        .resume-entry .description { margin-top: 8px; padding-left: 20px; font-size: 15px; line-height: 1.7; border-left: 2px solid #D1D5DB; }
        .resume-entry .description ul { padding-left: 5px; list-style-position: outside; }
        .resume-entry .description li { margin-bottom: 4px; }

        ul.skills-list { display: flex; flex-wrap: wrap; gap: 10px; list-style-type: none; padding: 0; }
        ul.skills-list li { background-color: #F3F4F6; padding: 6px 14px; border-radius: 8px; font-size: 14px; font-weight: 500; }

        /* --- 8. Theme Styles --- */
        .theme-purple .resume-header, .theme-purple .resume-section h3 { border-color: var(--primary-color); color: var(--primary-color); }
        .theme-purple ul.skills-list li { background-color: #F3F4F6; color: var(--dark-text); }
        .theme-purple .resume-entry .description { border-left-color: var(--primary-color); }
        .theme-purple .resume-content a { color: var(--primary-color); }

        .theme-blue .resume-header, .theme-blue .resume-section h3 { border-color: var(--secondary-color); color: var(--secondary-color); }
        .theme-blue ul.skills-list li { background-color: #DBEAFE; color: #1E40AF; }
        .theme-blue .resume-entry .description { border-left-color: var(--secondary-color); }
        .theme-blue .resume-content a { color: var(--secondary-color); }
        
        /* --- 9. Responsive & Print Styles --- */
        @media (max-width: 1400px) {
            #cmcv-form-section { width: 45%; padding: 30px; }
            #cmcv-preview-section { width: 55%; padding: 30px; }
        }

        @media (max-width: 1100px) {
            .forgemycv-container { flex-direction: column; }
            #cmcv-form-section { width: 100%; height: auto; position: relative; border-right: none; border-bottom: 1px solid var(--border-color); }
            #cmcv-preview-section { width: 100%; }
            #cmcv-resume-preview { margin-top: 20px; min-height: auto; max-width: 100%; }
        }

        @media (max-width: 768px) {
            #cmcv-form-section, #cmcv-preview-section, .cmcv-controls { padding: 20px; }
            .cmcv-controls { flex-direction: column; gap: 15px; align-items: stretch; }
            .resume-header h2 { font-size: 32px; }
            .resume-section h3 { font-size: 18px; }
        }
        
        @media print {
            body { background: none; }
            #cmcv-form-section, .cmcv-controls, .on-screen-credit { display: none !important; }
            #cmcv-preview-section { width: 100%; padding: 0; margin: 0; }
            #cmcv-resume-preview { width: 100%; height: 100%; max-width: none; min-height: 0; box-shadow: none; border: none; border-radius: 0; }
            .resume-content { padding: 0; }
        }
        /* --- END OF CSS REDESIGN --- */
    </style>
</head>
<body>
    <div class="forgemycv-container">
        <!-- The Form Section -->
        <div id="cmcv-form-section">
            <h1>
                <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.787 13.145L20.66 11.018L20 11.678V10H18V11.678L17.34 11.018L15.213 13.145L15.873 13.805L14 15.678V20H24V15.678L22.787 13.145ZM22 18H16V16.322L18 14.322L19.5 15.822L22 13.322V18Z"></path><path d="M11.3199 2.06995L2.26992 7.56995C2.11992 7.64995 1.99992 7.79995 1.99992 7.99995V17C1.99992 17.55 2.44992 18 2.99992 18H11.9999C12.5499 18 12.9999 17.55 12.9999 17V8C12.9999 7.8 12.8799 7.65 12.7299 7.57L12.0899 7.25L11.3199 2.06995Z"></path></g></svg>
                Forge<span>MyCV</span>
            </h1>

            <div class="cmcv-form-group">
                <h3>Personal Details</h3>
                <input type="text" id="fullName" placeholder="Full Name" oninput="updatePreview()">
                <input type="email" id="email" placeholder="Email Address" oninput="updatePreview()" style="margin-top: 15px;">
                <input type="tel" id="phone" placeholder="Phone Number" oninput="updatePreview()" style="margin-top: 15px;">
                <input type="text" id="address" placeholder="City, State" oninput="updatePreview()" style="margin-top: 15px;">
                <input type="url" id="linkedin" placeholder="LinkedIn Profile URL" oninput="updatePreview()" style="margin-top: 15px;">
                <input type="url" id="github" placeholder="GitHub Profile URL" oninput="updatePreview()" style="margin-top: 15px;">
            </div>
    
            <div class="cmcv-form-group">
                <label for="summary">Professional Summary</label>
                <textarea id="summary" placeholder="A brief, powerful summary of your skills and experience..." oninput="updatePreview()"></textarea>
            </div>
    
            <div class="cmcv-form-group">
                <h3>Education</h3>
                <div id="education-entries"></div>
                <button class="cmcv-btn cmcv-btn-add" onclick="addEntry('education')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                    Add Education
                </button>
            </div>
    
            <div class="cmcv-form-group">
                <h3>Work Experience</h3>
                <div id="experience-entries"></div>
                <button class="cmcv-btn cmcv-btn-add" onclick="addEntry('experience')">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                    Add Experience
                </button>
            </div>
            
            <div class="cmcv-form-group">
                <h3>Projects</h3>
                <div id="projects-entries"></div>
                <button class="cmcv-btn cmcv-btn-add" onclick="addEntry('projects')">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                    Add Project
                </button>
            </div>
    
             <div class="cmcv-form-group">
                <h3>Certifications</h3>
                <div id="certifications-entries"></div>
                <button class="cmcv-btn cmcv-btn-add" onclick="addEntry('certifications')">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                    Add Certification
                </button>
            </div>
            
            <div class="cmcv-form-group">
                <label for="techSkills">Technical Skills (comma-separated)</label>
                <input type="text" id="techSkills" placeholder="e.g. React, Node.js, Python..." oninput="updatePreview()">
            </div>
            <div class="cmcv-form-group">
                <label for="softSkills">Soft Skills (comma-separated)</label>
                <input type="text" id="softSkills" placeholder="e.g. Agile, Team Leadership..." oninput="updatePreview()">
            </div>
            <!-- Suggested AdSense Placement: 300x250 Medium Rectangle or similar vertical unit -->
            <div style="padding: 20px 0; text-align: center; color: #ccc;">
                <!-- Ad Unit Here -->
            </div>
        </div>
    
        <!-- The Preview Section -->
        <div id="cmcv-preview-section">
            <!-- Suggested AdSense Placement: 728x90 Leaderboard -->
             <div style="width: 100%; max-width: 816px; margin-bottom: 20px; text-align: center; color: #ccc;">
                <!-- Ad Unit Here -->
            </div>
            <div class="cmcv-controls">
                <div class="cmcv-control-group">
                    <label for="theme-select">Color Theme</label>
                    <select id="theme-select" onchange="changeTheme()">
                        <option value="purple">Royal Black (Default)</option>
                        <option value="blue">Modern Blue</option>
                    </select>
                </div>
                 <div class="cmcv-control-group">
                    <label for="layout-toggle">Layout</label>
                    <button id="layout-toggle" class="cmcv-btn" onclick="toggleLayout()" style="background-color: #4B5563; color: white;">1-Page Layout</button>
                </div>
                <div class="cmcv-control-group">
                    <label>Download Options</label>
                     <button class="cmcv-btn cmcv-btn-download" onclick="window.print()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-pdf" viewBox="0 0 16 16"><path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/><path d="M4.603 14.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.697 19.697 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.658-.879.38-.207.855-.214 1.222.015.354.22.58.592.681 1.006.134.52.077 1.018-.164 1.482-.25-.51-.375-.963-.404-1.338-.034-.42-.061-.83-.054-1.234.007-.403.04-.687.14-.848.101-.15.277-.25.518-.25.241 0 .435.1.56.25.124.15.187.386.193.646a4.3 4.3 0 0 1-.06 1.119 11.858 11.858 0 0 0-1.598.647c-.37.218-.684.495-.938.821a1.5 1.5 0 0 0-.434.887c-.012.317.051.638.192.907.181.341.503.632.962.866a10.02 10.02 0 0 0 2.05.627 15.14 15.14 0 0 1 1.28 5.516.5.5 0 1 1-.99.088c-.262-2.911-1.282-4.22-2.05-4.524-.759-.303-1.442-.423-1.9-.423-.429 0-.742.099-.962.247a.539.539 0 0 0-.258.423c-.01.122.016.253.068.393.078.216.203.46.41.724.208.264.44.534.695.817.255.283.51.585.765.913a.56.56 0 0 1-.806.59c-.256-.23-.5-.487-.74-.757-.245-.275-.477-.565-.694-.847a6.49 6.49 0 0 0-.48-2.035c-.06-.25-.09-.505-.09-.766.002-.23.034-.44.115-.63.081-.19.223-.33.415-.42.192-.09.43-.11.68-.06.246.045.43.15.57.29.14.14.21.318.21.522a3.09 3.09 0 0 1-.09 1.055 7.82 7.82 0 0 0-1.022.45c-.32.17-.59.38-.793.61a.72.72 0 0 0-.215.494.81.81 0 0 0 .416.716c.195.12.43.18.687.18a.95.95 0 0 0 .518-.171c.229-.116.42-.29.559-.51.139-.22.219-.481.219-.778a3.52 3.52 0 0 0-.122-1.224c.2-.1.38-.21.54-.33.16-.12.29-.25.39-.4.09-.14.15-.3.15-.47s-.06-.32-.15-.45c-.09-.13-.23-.24-.42-.32-.19-.08-.43-.11-.7-.07-.27.04-.5.16-.68.35-.18.19-.29.45-.33.75-.04.3-.01.64.09.98.04.14.08.28.12.43a.5.5 0 1 1-.93.36c-.05-.14-.09-.28-.13-.42-.1-.34-.12-.68-.08-1.02.05-.37.22-.68.51-.88.29-.2.68-.25 1.06-.13.38.12.67.36.87.72.2.35.25.79.13, 1.28-.13.48-.38.91-.73, 1.28-.35.37-.82.64-1.38.8-a6.9 6.9 0 0 1-2.04.627 1.5 1.5 0 0 0-.434.887.81.81 0 0 1-.438.42z"/></svg>
                        Save as PDF
                    </button>
                    <button class="cmcv-btn cmcv-btn-download" onclick="downloadDocx()" style="margin-top: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-word" viewBox="0 0 16 16"><path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/><path d="M4.225 11.684H5.455v.999H4.225v-1zM4.225 7.51h1.23v.999H4.225v-.999zM4.225 9.597h1.23v.999H4.225v-.999zM6.875 12.5h-1.5v-1h1.5v1zm-1.5-2.184h1.5v-1h-1.5v1zm-1.5-3.882h1.5v-1h-1.5v1zM6.875 9.5h-1.5v-1h1.5v1zm1.508 2.001L8.5 11.684h1.03l.152.283.152-.283h1.029l-1.187 2.182h-1.02l1.187-2.182zM10.15 8.51h-1.5v-1h1.5v1zm-1.5-2.184h1.5v-1h-1.5v1zM11.5 12.5h-1.5v-1h1.5v1zm-1.5-2.184h1.5v-1h-1.5v1zM11.5 8.5h-1.5v-1h1.5v1z"/></svg>
                        Download .DOCX
                    </button>
                </div>
            </div>
    
            <div id="cmcv-resume-preview"></div>

            <div class="on-screen-credit">
                Original Concept & Logic by <a href="https://github.com/prathampurohit" target="_blank" rel="noopener noreferrer">Pratham Purohit</a>. Redesigned by PrathamCreative Co.
            </div>
        </div>
    
    </div>
    
    <script>
        function escapeHTML(str) { if (!str) return ''; return str.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])); }

        document.addEventListener('DOMContentLoaded', function() {
            setInitialData();
            changeTheme(); 
            updatePreview();
        });

        function setInitialData() {
            document.getElementById('fullName').value = 'Aarav Mehta';
            document.getElementById('email').value = 'aarav.mehta@example.com';
            document.getElementById('phone').value = '+91 9876543210';
            document.getElementById('address').value = 'Mumbai, India';
            document.getElementById('linkedin').value = 'https://linkedin.com/in/aaravmehta';
            document.getElementById('github').value = 'https://github.com/aaravm-dev';
            document.getElementById('summary').value = 'Results-driven Software Engineer with 4+ years of experience designing, developing, and scaling high-performance web applications. Proficient in the MERN stack and cloud-native technologies, with a strong passion for creating seamless user experiences and solving complex problems.';
            addEntry('education', { degree: 'B.Tech in Computer Science', institute: 'IIT Bombay', year: '2015 – 2019', description: 'Graduated with a focus on algorithms and distributed systems.\nKey coursework: Data Structures, AI, Database Management.' });
            addEntry('experience', { job: 'Software Engineer', company: 'Tata Consultancy Services', years: '2020 – 2023', description: 'Developed and maintained client-side features for enterprise-level applications using React and Redux, improving user engagement metrics by 15%.\nCollaborated in an Agile team to deliver features on a bi-weekly sprint schedule.' });
            addEntry('experience', { job: 'Freelance Web Developer', company: 'Self-employed', years: '2019 – 2020', description: 'Created and deployed custom websites and e-commerce solutions for small businesses, resulting in an average 40% increase in online sales for clients.' });
            addEntry('projects', { title: 'Resume Builder App', tech: 'HTML, CSS, JavaScript', description: 'A fully client-side responsive resume builder allowing users to create, preview, and print professional resumes from multiple templates.', link: 'https://github.com/aaravm-dev/resume-app' });
            document.getElementById('techSkills').value = 'React, Node.js, Express, MongoDB, JavaScript (ES6+), HTML5, CSS3, Git, Docker, AWS, REST APIs';
            document.getElementById('softSkills').value = 'Agile Methodologies, Communication, Problem-solving, Team Collaboration, Project Management';
        }
        
        let entryCounters = { education: 0, experience: 0, projects: 0, certifications: 0 };
        function addEntry(type, data = {}) {
            const container = document.getElementById(`${type}-entries`);
            const entryId = entryCounters[type]++;
            const entryDiv = document.createElement('div');
            entryDiv.className = 'cmcv-dynamic-entry';
            entryDiv.id = `${type}-entry-${entryId}`;
            let fields = '';
            const removeBtn = `<button class="cmcv-btn cmcv-btn-remove" onclick="removeEntry('${type}', ${entryId})"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg> Remove</button>`;
            switch (type) {
                case 'education': fields = `<input type="text" placeholder="Degree / Certificate" class="degree" value="${data.degree || ''}" oninput="updatePreview()"><input type="text" placeholder="Institution / School" class="institute" value="${data.institute || ''}" oninput="updatePreview()"><input type="text" placeholder="Year(s)" class="year" value="${data.year || ''}" oninput="updatePreview()"><textarea placeholder="Description (use new lines for bullet points)" class="description" oninput="updatePreview()">${data.description || ''}</textarea>`; break;
                case 'experience': fields = `<input type="text" placeholder="Job Title" class="job" value="${data.job || ''}" oninput="updatePreview()"><input type="text" placeholder="Company" class="company" value="${data.company || ''}" oninput="updatePreview()"><input type="text" placeholder="Dates of Employment" class="years" value="${data.years || ''}" oninput="updatePreview()"><textarea placeholder="Key Responsibilities (use new lines for bullet points)" class="description" oninput="updatePreview()">${data.description || ''}</textarea>`; break;
                case 'projects': fields = `<input type="text" placeholder="Project Title" class="title" value="${data.title || ''}" oninput="updatePreview()"><input type="text" placeholder="Technologies Used" class="tech" value="${data.tech || ''}" oninput="updatePreview()"><input type="url" placeholder="Project Link (optional)" class="link" value="${data.link || ''}" oninput="updatePreview()"><textarea placeholder="Description" class="description" oninput="updatePreview()">${data.description || ''}</textarea>`; break;
                case 'certifications': fields = `<input type="text" placeholder="Certificate Name" class="name" value="${data.name || ''}" oninput="updatePreview()"><input type="url" placeholder="Link (optional)" class="link" value="${data.link || ''}" oninput="updatePreview()">`; break;
            }
            entryDiv.innerHTML = `${fields}${removeBtn}`;
            container.appendChild(entryDiv);
            if (!Object.keys(data).length) { updatePreview(); }
        }
        function removeEntry(type, id) { 
            const entryToRemove = document.getElementById(`${type}-entry-${id}`);
            if(entryToRemove) {
                 entryToRemove.style.animation = 'fadeOut 0.4s ease forwards';
                 setTimeout(() => { entryToRemove.remove(); updatePreview(); }, 400);
            }
        }
        function getEntries(type) {
            const entries = [];
            document.querySelectorAll(`#${type}-entries .cmcv-dynamic-entry`).forEach(e => { const d = {}; e.querySelectorAll('input, textarea').forEach(i => { if(i.className.split(' ').length > 0) d[i.className.split(' ')[0]] = i.value; }); entries.push(d); });
            return entries;
        }

        function updatePreview() {
            const data = {
                fullName: document.getElementById('fullName').value, email: document.getElementById('email').value, phone: document.getElementById('phone').value, address: document.getElementById('address').value, linkedin: document.getElementById('linkedin').value, github: document.getElementById('github').value, summary: document.getElementById('summary').value,
                education: getEntries('education'), experience: getEntries('experience'), projects: getEntries('projects'), certifications: getEntries('certifications'),
                techSkills: document.getElementById('techSkills').value.split(',').map(s => s.trim()).filter(Boolean), softSkills: document.getElementById('softSkills').value.split(',').map(s => s.trim()).filter(Boolean),
            };
            document.getElementById('cmcv-resume-preview').innerHTML = generateResumeHTML(data);
            changeTheme(); // Re-apply theme
        }

        function generateResumeHTML(data) {
            const s = Object.fromEntries(Object.entries(data).map(([k, v]) => {
                if (typeof v === 'string') return [k, escapeHTML(v)];
                if (Array.isArray(v)) return [k, v.map(item => (typeof item === 'string') ? escapeHTML(item) : Object.fromEntries(Object.entries(item).map(([key, val]) => [key, escapeHTML(val)])))];
                return [k,v];
            }));
            
            const formatDescription = (desc) => {
                if (!desc) return '';
                const points = desc.split('\n').filter(Boolean);
                if (points.length === 0) return '';
                return `<ul>${points.map(p => `<li>${p}</li>`).join('')}</ul>`;
            };

            const contact = `<div class="resume-contact-info">${s.email?`<span><a href="mailto:${s.email}">${s.email}</a></span>`:''}${s.phone?`<span>${s.phone}</span>`:''}${s.address?`<span>${s.address}</span>`:''}${s.linkedin?`<span><a href="${s.linkedin}" target="_blank">LinkedIn</a></span>`:''}${s.github?`<span><a href="${s.github}" target="_blank">GitHub</a></span>`:''}</div>`;
            const summary = s.summary ? `<div class="resume-section"><h3>Professional Summary</h3><p>${s.summary.replace(/\n/g, '<br>')}</p></div>` : '';
            const education = s.education.length ? `<div class="resume-section"><h3>Education</h3>${s.education.map(e => `<div class="resume-entry"><div class="resume-entry-header"><span class="title">${e.degree || ''} at ${e.institute || ''}</span><span class="meta">${e.year || ''}</span></div>${e.description ? `<div class="description">${formatDescription(e.description)}</div>` : ''}</div>`).join('')}</div>` : '';
            const experience = s.experience.length ? `<div class="resume-section"><h3>Experience</h3>${s.experience.map(e => `<div class="resume-entry"><div class="resume-entry-header"><span class="title">${e.job || ''} at ${e.company || ''}</span><span class="meta">${e.years || ''}</span></div>${e.description ? `<div class="description">${formatDescription(e.description)}</div>` : ''}</div>`).join('')}</div>` : '';
            const projects = s.projects.length ? `<div class="resume-section"><h3>Projects</h3>${s.projects.map(p => `<div class="resume-entry"><div class="resume-entry-header"><span class="title">${p.title || ''}</span><span class="meta">${p.tech || ''}</span></div><div class="description">${p.description} ${p.link ? `(<a href="${p.link}" target="_blank">Link</a>)` : ''}</div></div>`).join('')}</div>` : '';
            const certs = s.certifications.length ? `<div class="resume-section"><h3>Certifications</h3><ul class="skills-list">${s.certifications.map(c => `<li>${c.link ? `<a href="${c.link}" target="_blank">${c.name}</a>` : c.name}</li>`).join('')}</ul></div>` : '';
            const skills = s.techSkills.length || s.softSkills.length ? `<div class="resume-section">${s.techSkills.length ? `<h4>Technical Skills</h4><ul class="skills-list">${s.techSkills.map(skill => `<li>${skill}</li>`).join('')}</ul>` : ''}${s.softSkills.length ? `<h4>Soft Skills</h4><ul class="skills-list">${s.softSkills.map(skill => `<li>${skill}</li>`).join('')}</ul>` : ''}</div>` : '';
            
            return `<div class="resume-content template-classic"><div class="resume-header"><h2>${s.fullName}</h2>${contact}</div>${summary}${experience}${education}${projects}${skills}${certs}</div>`;
        }
        
        function changeTheme() {
            const preview = document.getElementById('cmcv-resume-preview');
            const selectedTheme = document.getElementById('theme-select').value;
            // Reset classes before adding new ones
            preview.className = '';
            preview.classList.add(`theme-${selectedTheme}`);
            if (document.getElementById('layout-toggle').textContent.includes('2-Page')) {
                preview.classList.add('two-page');
            }
        }
        function toggleLayout() {
            const preview = document.getElementById('cmcv-resume-preview');
            const button = document.getElementById('layout-toggle');
            preview.classList.toggle('two-page');
            button.textContent = preview.classList.contains('two-page') ? '2-Page Layout' : '1-Page Layout';
        }

        function downloadDocx() {
            // 1. Get the HTML content of the preview
            const previewNode = document.getElementById('cmcv-resume-preview').cloneNode(true);
            
            // 2. Extract relevant CSS rules to embed them. This is crucial for Word formatting.
            let cssText = '';
            for (const sheet of document.styleSheets) {
                try {
                    for (const rule of sheet.cssRules) {
                        // We only need the rules that apply to the resume content itself
                        if (rule.selectorText && (rule.selectorText.includes('.resume-') || rule.selectorText.includes('.skills-list') || rule.selectorText.includes('#cmcv-resume-preview'))) {
                            cssText += rule.cssText + '\n';
                        }
                    }
                } catch (e) {
                    console.warn("Could not read cross-origin stylesheet. Some styles may not be exported.", e);
                }
            }

            // Get the selected theme to apply correct colors in DOCX
            const selectedTheme = document.getElementById('theme-select').value;
            previewNode.className = `theme-${selectedTheme}`; // ensure the class is set on the cloned node

            // 3. Construct the full HTML for the DOCX file
            const html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        /* Basic page setup for Word */
                        @page {
                            size: 8.5in 11in;
                            margin: 0.75in;
                        }
                        body {
                            font-family: 'Inter', sans-serif;
                            font-size: 11pt; /* Word uses points */
                        }
                        /* All the extracted CSS rules */
                        ${cssText}
                    </style>
                </head>
                <body>
                    ${previewNode.innerHTML}
                </body>
                </html>
            `;
            
            // 4. Create a Blob and trigger the download
            const blob = new Blob(['\ufeff', html], {
                type: 'application/msword'
            });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'resume.docx';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

    </script>
</body>
</html>